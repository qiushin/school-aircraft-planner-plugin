# 基于渔网线的无人机网格路径规划功能

## 概述

新的网格路径规划功能**直接使用您提供的渔网线**作为可飞行路径网络，专门设计用于处理基于渔网线数据的避障路径规划，能够有效地规划访问大量风险点（约300个）的最优路径。

**重要说明：本功能不会重新构建网格，而是直接使用您的渔网线Shapefile作为预定义的飞行路径网络。**

该功能相比之前的简单最近邻算法，具有以下优势：

- **直接使用现有网格**：无需重新构建，直接使用您的渔网线数据
- **避障能力**：基于渔网线数据确保路径在安全区域内
- **优化算法**：采用TSP+Dijkstra算法，能够找到访问所有风险点的最短路径
- **大规模处理**：专门优化处理300个左右风险点的规划需求
- **灵活配置**：支持多种算法选择和参数配置

## 核心算法

### 1. 网格加载算法
- 直接从渔网线Shapefile文件中加载线段数据
- 从线段的端点提取网格节点
- 根据线段连接关系建立节点间的邻接关系
- 保持原始渔网线的拓扑结构和连接性

### 2. 风险点关联算法
- 将风险点关联到最近的网格节点
- 可配置最大关联距离（默认50米）
- 超出距离阈值的风险点将被忽略

### 3. 路径优化算法

#### TSP+Dijkstra算法（推荐）
- 使用最近邻算法求解旅行商问题，确定访问风险点的顺序
- 使用Dijkstra算法在网格中寻找每两个风险点间的最短路径
- 支持2-opt优化改进路径质量

#### Dijkstra算法
- 经典最短路径算法
- 适合简单的点对点路径规划

#### A*算法
- 带启发式的最短路径算法
- 计算效率比Dijkstra更高

## 使用步骤

### 1. 准备数据文件

#### 渔网线文件（必需）
- 格式：Shapefile (.shp)
- 内容：表示可飞行区域的网格线或面
- 建议：确保渔网线覆盖整个规划区域

#### 风险点文件（必需）
- 格式：Shapefile (.shp)
- 内容：需要访问的风险点位置
- 建议：风险点应位于渔网线覆盖区域内

### 2. 启动规划工具

1. 启动应用程序
2. 在菜单栏选择 "Route Planning" -> "网格路径规划 (基于渔网线)"
3. 网格路径规划对话框将打开

### 3. 配置规划参数

#### 输入文件
- **渔网线文件**：点击"浏览"选择渔网线Shapefile
- **风险点文件**：点击"浏览"选择风险点Shapefile

#### 规划参数
- **起始点坐标**：设置无人机的起始位置（X, Y, Z）
- **风险点最大关联距离**：设置风险点与网格节点的最大关联距离（建议50米）

#### 算法选择
- **TSP_Dijkstra**：推荐用于大量风险点的完整路径规划
- **Dijkstra**：适合简单的点对点路径规划
- **AStar**：适合有明确目标的高效路径规划

#### 输出设置
- **输出目录**：设置结果文件的保存位置

### 4. 执行规划

1. 点击"执行规划"按钮
2. 系统将显示规划进度：
   - 加载渔网线网格（0-30%）
   - 加载风险点（30-50%）
   - 关联风险点到网格（50-60%）
   - 寻找起始节点（60-65%）
   - 执行路径规划算法（65-95%）
   - 计算统计信息（95-100%）

### 5. 查看结果

#### 规划统计信息
- 网格节点总数
- 风险点总数和访问数量
- 路径总长度
- 风险点覆盖率
- 使用的算法

#### 导出结果
规划完成后，可以导出以下文件：
- **grid_path.csv**：路径点详细信息（坐标、类型、距离等）
- **grid_path.wkt**：WKT格式的路径几何
- **grid_path_statistics.txt**：详细统计报告

## 性能优化建议

### 针对300个风险点的优化

1. **网格密度控制**：
   - 渔网线间距建议控制在20-50米
   - 避免过密的网格导致计算复杂度过高

2. **算法选择**：
   - 对于300个风险点，推荐使用TSP_Dijkstra算法
   - 可以考虑分区域规划，然后合并结果

3. **内存管理**：
   - 大规模规划可能需要较多内存
   - 建议在性能较好的计算机上运行

## 故障排除

### 常见问题

1. **"No risk points found within the grid"**
   - 检查风险点是否在渔网线覆盖范围内
   - 增大风险点最大关联距离
   - 确认坐标系统一致

2. **"Cannot find start node in the grid"**
   - 检查起始点坐标是否在网格范围内
   - 确认坐标系和单位正确

3. **规划时间过长**
   - 减少网格密度
   - 考虑分区域规划
   - 选择更简单的算法

### 性能建议

- **推荐硬件配置**：
  - 内存：8GB及以上
  - 处理器：多核CPU
  - 存储：SSD硬盘

- **数据优化**：
  - 预处理渔网线数据，移除不必要的节点
  - 确保风险点数据质量，移除重复点

## 技术规格

- **支持的坐标系**：任何投影坐标系
- **支持的文件格式**：Shapefile (.shp)
- **最大风险点数量**：建议500个以内
- **路径算法**：Dijkstra, A*, TSP+Dijkstra
- **输出格式**：CSV, WKT, 统计报告

## 更新说明

### 相比旧版本的改进

1. **新增避障功能**：基于渔网线数据实现真正的避障路径规划
2. **支持大规模数据**：优化算法处理300个风险点
3. **多算法支持**：提供多种路径规划算法选择
4. **更好的用户界面**：专门的网格路径规划对话框
5. **详细的结果分析**：提供完整的统计信息和多种导出格式

### 已删除的功能

- 旧的简单最近邻路径规划算法
- 不支持避障的基础路径规划功能

这些旧功能已被新的网格路径规划系统完全取代，提供更强大和实用的路径规划能力。 